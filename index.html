<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>רשימת הקניות שלי</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4F46E5">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: #f0f4f8;
            padding-bottom: 220px;
            min-height: 100vh;
        }
        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 1000;
            padding: 1.5rem;
            border-top-left-radius: 2rem;
            border-top-right-radius: 2rem;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body class="p-4">
    <div class="max-w-2xl mx-auto">
        <!-- Input Form -->
        <div id="inputForm" class="bg-white p-6 rounded-2xl shadow-md mb-4 hidden">
            <div class="space-y-4">
                <input type="text" id="itemName" placeholder="שם המוצר" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none">
                <input type="number" id="itemPrice" placeholder="מחיר ליחידה (₪)" step="0.01" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none">
                <div class="flex gap-3">
                    <button id="addBtn" class="flex-1 bg-green-500 text-white py-3 rounded-xl font-bold active:scale-95 transition">הוסף</button>
                    <button id="cancelBtn" class="flex-1 bg-gray-400 text-white py-3 rounded-xl font-bold active:scale-95 transition">ביטול</button>
                </div>
            </div>
        </div>

        <!-- Items List -->
        <div id="itemsList" class="space-y-3"></div>

        <!-- Empty State -->
        <div id="emptyState" class="bg-white p-12 rounded-2xl shadow-sm text-center text-gray-400">
            <p class="text-lg">הרשימה ריקה</p>
            <p class="text-sm mt-2">לחץ על + להוספת מוצר</p>
        </div>
    </div>

    <!-- Bottom Bar -->
    <div class="bottom-bar">
        <div class="max-w-2xl mx-auto">
            <div class="grid grid-cols-2 gap-4 text-white mb-6">
                <div class="text-center">
                    <p class="text-sm opacity-90 mb-1">שולם (✓):</p>
                    <p class="text-3xl font-black">₪<span id="paidTotal">0.00</span></p>
                </div>
                <div class="text-center">
                    <p class="text-sm opacity-90 mb-1">סה"כ רשימה:</p>
                    <p class="text-3xl font-black">₪<span id="grandTotal">0.00</span></p>
                </div>
            </div>

            <div class="flex justify-center items-center gap-6">
                <button id="clearBtn" class="w-16 h-16 bg-red-500 rounded-full shadow-2xl active:scale-90 transition hidden">
                    <svg class="w-8 h-8 mx-auto text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                </button>
                <button id="addNewBtn" class="w-20 h-20 bg-green-500 rounded-full shadow-2xl -mt-8 active:scale-90 transition">
                    <svg class="w-12 h-12 mx-auto text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-width="3" d="M12 4v16m8-8H4"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'SHOPPING_APP_2025';
        let items = [];

        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupEvents();
            render();
        });

        function setupEvents() {
            document.getElementById('addNewBtn').onclick = showForm;
            document.getElementById('addBtn').onclick = addItem;
            document.getElementById('cancelBtn').onclick = hideForm;
            document.getElementById('clearBtn').onclick = clearAll;
            
            document.getElementById('itemName').onkeypress = function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('itemPrice').focus();
                }
            };
            
            document.getElementById('itemPrice').onkeypress = function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addItem();
                }
            };
        }

        function loadData() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                items = saved ? JSON.parse(saved) : [];
            } catch (e) {
                items = [];
            }
        }

        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
        }

        function showForm() {
            document.getElementById('inputForm').classList.remove('hidden');
            document.getElementById('itemName').value = '';
            document.getElementById('itemPrice').value = '';
            setTimeout(() => document.getElementById('itemName').focus(), 100);
        }

        function hideForm() {
            document.getElementById('inputForm').classList.add('hidden');
        }

        function addItem() {
            const name = document.getElementById('itemName').value.trim();
            const price = parseFloat(document.getElementById('itemPrice').value) || 0;

            if (!name) {
                alert('נא להזין שם מוצר');
                return;
            }

            items.push({
                id: Date.now(),
                name: name,
                unitPrice: price,
                quantity: 1,
                totalPrice: price,
                checked: false
            });

            saveData();
            
            // שימוש ב-requestAnimationFrame לעדכון חלק
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    render();
                });
            });
            
            hideForm();
        }

        function deleteItem(id) {
            if (confirm('למחוק מוצר זה?')) {
                items = items.filter(item => item.id !== id);
                saveData();
                render();
            }
        }

        function toggleCheck(id) {
            const item = items.find(i => i.id === id);
            if (item) {
                item.checked = !item.checked;
                saveData();
                render();
            }
        }

        function changeQty(id, delta) {
            const item = items.find(i => i.id === id);
            if (item) {
                item.quantity += delta;
                if (item.quantity < 1) item.quantity = 1;
                item.totalPrice = item.unitPrice * item.quantity;
                saveData();
                render();
            }
        }

        function clearAll() {
            if (confirm('האם אתה בטוח שברצונך למחוק את כל הרשימה?')) {
                items = [];
                saveData();
                render();
            }
        }

        function render() {
            const list = document.getElementById('itemsList');
            const empty = document.getElementById('emptyState');
            const clearBtn = document.getElementById('clearBtn');

            if (items.length === 0) {
                list.innerHTML = '';
                empty.classList.remove('hidden');
                clearBtn.classList.add('hidden');
                updateTotals();
                return;
            }

            empty.classList.add('hidden');
            clearBtn.classList.remove('hidden');

            list.innerHTML = items.map(item => {
                const bgClass = item.checked ? 'bg-green-50 border-green-300' : 'bg-white border-gray-100';
                const textClass = item.checked ? 'line-through text-gray-400' : 'text-gray-800';
                
                return `
                <div class="${bgClass} border-2 rounded-2xl p-4 shadow-sm">
                    <div class="flex items-center gap-3">
                        <input type="checkbox" ${item.checked ? 'checked' : ''} 
                               onclick="toggleCheck(${item.id})"
                               class="w-8 h-8 rounded border-2 border-gray-300 cursor-pointer">
                        <div class="flex-1">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-bold text-xl ${textClass}">${item.name}</h3>
                                <span class="font-black text-2xl text-indigo-600 ${textClass}">₪${item.totalPrice.toFixed(2)}</span>
                            </div>
                            <p class="text-sm text-gray-500 mb-3 ${textClass}">(₪${item.unitPrice.toFixed(2)} × ${item.quantity})</p>
                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-2 bg-gray-50 border-2 border-gray-200 rounded-xl p-1">
                                    <button onclick="changeQty(${item.id}, 1)" 
                                            class="w-12 h-12 bg-white rounded-lg shadow-sm text-green-600 font-black text-2xl active:scale-90">
                                        +
                                    </button>
                                    <span class="font-black text-xl w-12 text-center">${item.quantity}</span>
                                    <button onclick="changeQty(${item.id}, -1)" 
                                            class="w-12 h-12 bg-white rounded-lg shadow-sm text-red-500 font-black text-2xl active:scale-90">
                                        −
                                    </button>
                                </div>
                                <button onclick="deleteItem(${item.id})" 
                                        class="w-14 h-14 bg-red-50 text-red-500 rounded-xl active:scale-90">
                                    <svg class="w-7 h-7 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                `;
            }).join('');

            updateTotals();
        }

        function updateTotals() {
            const total = items.reduce((sum, item) => sum + item.totalPrice, 0);
            const paid = items.filter(i => i.checked).reduce((sum, item) => sum + item.totalPrice, 0);
            
            document.getElementById('grandTotal').textContent = total.toFixed(2);
            document.getElementById('paidTotal').textContent = paid.toFixed(2);
        }
    </script>
</body>
</html>
